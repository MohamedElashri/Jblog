<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Monte Carlo Simulation of 2D Ising Model | My Blog </title> <meta name="description" content=" Monte Carlo Simulation of 2D Ising Model using Metropolis algorithm Python and Numba "> <meta name="keywords" content="Monte Carlo, Ising Model, Python, Numba, Metropolis Algorithm"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="MohamedElashri"> <meta name="twitter:title" content=" Monte Carlo Simulation of 2D Ising Model | My Blog "> <meta name="twitter:description" content=" Monte Carlo Simulation of 2D Ising Model using Metropolis algorithm Python and Numba "> <meta name="twitter:image:src" content="https://blog.melashri.net"> <!-- Canonical link tag --> <link rel="canonical" href="https://blog.melashri.net/2021/Monte-Carlo-Simulation-of-Ising-Model/"> <link rel="alternate" type="application/rss+xml" title="My Blog" href="https://blog.melashri.net/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="https://blog.melashri.net/assets/css/main.css"> <link rel="stylesheet" href="/assets/css/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="https://blog.melashri.net/">My Blog<span></span></a> </h1> <ul class="navbar"> <li><a href="https://blog.melashri.net/about">About</a></li> <li><a href="https://blog.melashri.net/feed.xml" target="_blank">RSS</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"><time datetime="2021-06-17T00:00:00+00:00" itemprop="datePublished">Jun 17, 2021</time></p> <h1 class="post-title" itemprop="name headline">Monte Carlo Simulation of 2D Ising Model</h1> </header> <div class="post-content" itemprop="articleBody"> <ul> <li><a href="#introduction">Introduction</a></li> <li><a href="#the-ising-model">The Ising Model</a></li> <li><a href="#monte-carlo-simulation">Monte-Carlo Simulation</a> <ul> <li><a href="#physical-model">Physical Model</a></li> <li><a href="#python-implementation">Python Implementation</a> <ul> <li><a href="#python-code-for-ising-model">Python code for Ising model</a></li> </ul> </li> </ul> </li> <li><a href="#results">Results</a></li> <li><a href="#reproduction">Reproduction</a></li> <li><a href="#appendix-i">Appendix I</a></li> <li><a href="#appendix-ii">Appendix II</a> <ul> <li><a href="#results-1">Results</a> <ul> <li><a href="#python-311">python 3.11</a></li> <li><a href="#python-310">python 3.10</a></li> <li><a href="#python-39">python 3.9</a></li> <li><a href="#python-38">python 3.8</a></li> <li><a href="#other-versions">Other versions</a></li> </ul> </li> </ul> </li> </ul> <h2 id="introduction">Introduction</h2> <p>During my first year PhD at UC, I get the chance to take statistical mechanics class from a condensed matter physicist. It was a new experience when he focused too much on different side that I did not explore before. The final project in this class was about using Monte-Carlo method to simulate the Ising model. Ising model is a model of a system that undergoes a phase transition. There are many reasons why this model is interesting when it is not representing any actual physical systems.</p> <ol> <li>It can be solved exactly, We can calculate the thermodynamical quantities and interpret them. In another can calculate the partition function and put it in an exact form.</li> <li>Ising model exhibits symmetry breaking in low-temperature phase.</li> <li>It is a simple model that can be used to understand the physics of phase transition.</li> <li>The Ising model is simple, yet it can be applied to many physical systems. This gives us a feature about universality, a feature that tells us that in such case the same theory applies to all sorts of different phase transitions.</li> </ol> <h2 id="the-ising-model">The Ising Model</h2> <p>We can think of Ising model as a mathematical model where everything consists of small squares inside a bigger one. It is usually called lattices where we then have a big lattice of sites (small boxes) where each site can be in one of two states. Those states as we will see will refer to the spin state of the electron inside this site. Each site will be labeled by index ii. The Hamiltonian for the Ising model can be written as</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">H</mi><mo>=</mo><mo>−</mo><mi>J</mi><munder><mo>∑</mo><mrow><mo stretchy="false">⟨</mo><mi>i</mi><mi>j</mi><mo stretchy="false">⟩</mo></mrow></munder><msub><mi>S</mi><mi>i</mi></msub><msub><mi>S</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex"> \mathcal{H}=-J \sum_{\langle i j\rangle} S_i S_j </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.00965em;">H</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.5660100000000003em;vertical-align:-1.516005em;"></span><span class="mord">−</span><span class="mord mathdefault" style="margin-right:0.09618em;">J</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.050005em;"><span style="top:-1.808995em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">⟨</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mclose mtight">⟩</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.516005em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span></span></p> <p><img src="/assets/images/posts/ising/ising.jpg" alt="Lattice square representation of Ising model, https://stanford.edu/~jeffjar/statmech/intro4.html" class="center-image" /></p> <ul> <li>Spin <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">S_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> has value of +1 or -1.</li> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>j</mi></mrow><annotation encoding="application/x-tex"> i j </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right:0.05724em;">j</span></span></span></span> implying that we are interested in nearest-neighbor interaction only.</li> <li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi></mrow><annotation encoding="application/x-tex">J</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.09618em;">J</span></span></span></span> is the interaction strength where ( J&gt;0 ) assuming that strength is positive.</li> </ul> <p>There are many systems that can be represented using this model like “lattice gas” with each of the sites is the possible location of a particle; means that site is empty and means that site is occupied by a particle.</p> <p>This system will undergo a 2nd order phase transition at some temperature <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>=</mo><msub><mi>T</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">T=T_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> which is called critical temperature. For cases when <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>&lt;</mo><msub><mi>T</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">T &lt; T_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, the system magnetizes, and the state is called the ferromagnetic state which is an ordered state. For cases when T &gt; T_c ​, the system is disordered or in a paramagnetic state. We can define the order parameter for this system to be the average magnetization <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span>.</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mfrac><mrow><mo stretchy="false">⟨</mo><mi>S</mi><mo stretchy="false">⟩</mo></mrow><mi>N</mi></mfrac></mrow><annotation encoding="application/x-tex"> m=\frac{\langle S\rangle}{N} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">⟨</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mclose">⟩</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> <p>This parameter is used to distinguish between the two phases that this system can have. It is zero when we are in disordered (paramagnetic) state and takes a non-zero value in ordered (ferromagnetic) state.</p> <h2 id="monte-carlo-simulation">Monte-Carlo Simulation</h2> <p>In this section, I’m going through the details of implementing the Monte-Carlo (MC) method for our Ising model. I apply the MC methods using Metropolis Algorithm to Ising model and extract physical parameters (Energy, Specific heat and Magnetization).</p> <h3 id="physical-model">Physical Model</h3> <p>Lattice is a periodical structure of points that align one by one. 2D lattice can be plotted as:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* * * * * * * *   
* * * * * * * * 
* * * * * * * *
* * * * * * * *
* * * * * * * *
</code></pre></div></div> <p>The points in lattice are called lattice points, nearest lattice points of point ^ are those lattice points denoted by (*) shown in the graph below:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* * *(*)* * * *
* *(*)^(*)* * *
* * *(*)* * * *
* * * * * * * *
</code></pre></div></div> <p>Each lattice point is denoted by a number i in the Hamiltonian.</p> <p>The expression for the Energy of the total system is</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>=</mo><mo>−</mo><mi>J</mi><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></munderover><mrow><mo fence="true">(</mo><msub><mi>s</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><msub><mi>s</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>s</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></msub><msub><mi>s</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn><mo separator="true">,</mo><mi>j</mi></mrow></msub><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex"> H=-J \sum_{i=0}^{N-1} \sum_{j=0}^{N-1}\left(s_{i, j} s_{i, j+1}+s_{i, j} s_{i+1, j}\right) </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.2421130000000007em;vertical-align:-1.4137769999999998em;"></span><span class="mord">−</span><span class="mord mathdefault" style="margin-right:0.09618em;">J</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000006em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4137769999999998em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mathdefault mtight" style="margin-right:0.05724em;">j</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* * * * * * * * 
* * * * * * * *
* * * * * * * * &lt;-the i-th lattice point
* * * * * * * *
* * * * * * * *
</code></pre></div></div> <p>Periodical structure means that lattice point at(1,1) is the same as that at(1,9) if the lattice is 5 x 8. For example (1,1)&lt;=&gt;(6,1), (2,3)&lt;=&gt;(2,11). A 2D lattice can be any <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">N_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> by <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">N_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>. The location <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x,y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span> here is another denotion of lattice point that is fundamentally same as i-th lattice point denotation above.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* * * * * * * * 4
* * * * * * * * 3
* * * * * * * * 2
* * * * * * * * 1
1 2 3 4 5 6 7 8 
</code></pre></div></div> <h3 id="python-implementation">Python Implementation</h3> <p>Algorithm</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. Prepare some initial configurations of N spins.
2. Flip spin of a lattice site chosen randomly
3. Calculate the change in energy due to that
4. If this change is negative, accept such move. If change is positive, accept it with probability exp^{-dE/kT}
5. Repeat 2-4.
6. Calculate Other parameters and plot them
</code></pre></div></div> <h4 id="python-code-for-ising-model">Python code for Ising model</h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="c1">##  Import needed python libraries 
</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span> <span class="c1"># for faster computation
</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>  <span class="c1"># for array and matrix operations
</span>
<span class="kn">import</span> <span class="nn">random</span> <span class="c1"># for random number generation
</span>
<span class="kn">import</span> <span class="nn">time</span> <span class="c1"># for timing the code 
</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span> <span class="c1"># for progress bar
</span>
<span class="c1">#from tqdm.notebook import tqdm # for progress bar in jupyter notebook
</span></code></pre></div></div> <p>Firrst, we need to define the parameters of the system. We will use the following parameters:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define parameters 
</span>
<span class="n">B</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1"># Magnetic field strength
</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span> <span class="c1"># Lattice size (width)
</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">))</span> <span class="c1"># Begin with random spin sites with values (+1 or -1) for up or down spins. 
</span>
<span class="n">n</span><span class="o">=</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">L</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># number of MC sweeps 
</span>
<span class="n">Temperature</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.6</span><span class="p">,</span><span class="mf">3.25</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span> <span class="c1"># Initlaize temperature range, takes form np.arange(start,stop,step)
</span>
</code></pre></div></div> <p>And after that we need to define the main function to calculate the energy of the system. We will use the following function:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define functions to compute energy and magnetization
</span>
<span class="s">'''
Energy of the lattice calculations. 

The energy here is simply the sum of interactions between spins divided by the total number of spins
'''</span>

<span class="o">@</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># wonderful jit optimization compiler in its high performance mode
</span>
<span class="k">def</span> <span class="nf">calcE</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>

    <span class="n">E</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>

            <span class="n">E</span> <span class="o">+=</span> <span class="o">-</span><span class="n">dE</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">E</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span>
    
 <span class="s">'''
Calculate the Magnetization of a given configuration

Magnetization is the sum of all spins divided by the total number of spins

'''</span>

<span class="o">@</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> 

<span class="k">def</span> <span class="nf">calcM</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nb">sum</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">m</span><span class="o">/</span><span class="n">L</span><span class="o">**</span><span class="mi">2</span>

</code></pre></div></div> <p>The next step is to define the function to calculate the change in energy due to a spin flip. We will use the following function:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Calculate interaction energy between spins. Assume periodic boundaries.
</span>
<span class="c1"># Interaction energy will be the difference in energy due to flipping spin i,j 
</span>
<span class="c1"># (Example: 2*spin_value*neighboring_spins)
</span>
<span class="o">@</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> 

<span class="k">def</span> <span class="nf">dE</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span> <span class="c1"># change in energy function
</span>
    <span class="c1">#top
</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># periodic boundary (top)
</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">t</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>

    <span class="c1">#bottom
</span>    
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># periodic boundary (bottom)
</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>

    <span class="c1">#left
</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># periodic boundary (left)
</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">l</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#right
</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># periodic boundary  (right)
</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="n">l</span><span class="p">)</span>  <span class="c1"># difference in energy is i,j is flipped
</span>
</code></pre></div></div> <p>Now we implement the Metropolis Algorithm to flip the spin of a lattice site chosen randomly. We will use the following function:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># Monte-carlo sweep implementation
</span>
<span class="o">@</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> 

<span class="k">def</span> <span class="nf">mc</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">Temp</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>   

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>  <span class="c1"># choose random row
</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>  <span class="c1"># choose random column
</span>
        <span class="n">ediff</span> <span class="o">=</span> <span class="n">dE</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ediff</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># if the change in energy is negative
</span>
            <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>  <span class="c1"># accept move and flip spin
</span>
        <span class="k">elif</span> <span class="n">random</span><span class="p">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ediff</span><span class="o">/</span><span class="n">Temp</span><span class="p">):</span> <span class="c1"># if not accept it with probability exp^{-dU/kT}
</span>
            <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">s</span>

</code></pre></div></div> <p>And finally we implement the main function to calculate the energy and magnetization of the system. We will use the following function:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Compute physical quantities
</span>
<span class="o">@</span><span class="n">jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> 

<span class="k">def</span> <span class="nf">physics</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>

    <span class="n">En</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">En_sq</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">Mg</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">Mg_sq</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">mc</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">E</span> <span class="o">=</span> <span class="n">calcE</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="n">M</span> <span class="o">=</span> <span class="n">calcM</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="n">En</span> <span class="o">+=</span> <span class="n">E</span>

        <span class="n">Mg</span> <span class="o">+=</span> <span class="n">M</span>

        <span class="n">En_sq</span> <span class="o">+=</span> <span class="n">E</span><span class="o">*</span><span class="n">E</span>

        <span class="n">Mg_sq</span> <span class="o">+=</span> <span class="n">M</span><span class="o">*</span><span class="n">M</span>

    <span class="n">En_avg</span> <span class="o">=</span> <span class="n">En</span><span class="o">/</span><span class="n">n</span>

    <span class="n">mag</span> <span class="o">=</span> <span class="n">Mg</span><span class="o">/</span><span class="n">n</span>

    <span class="n">CV</span> <span class="o">=</span> <span class="p">(</span><span class="n">En_sq</span><span class="o">/</span><span class="n">n</span><span class="o">-</span><span class="p">(</span><span class="n">En</span><span class="o">/</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">En_avg</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">CV</span>

</code></pre></div></div> <p>And we initialize the arrays to store the values of the energy, magnetization and specific heat capacity. And we use <code class="highlighter-rouge">time()</code> function to calculate the time taken by the code to run. We will use the following code:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Inititalize magnetization, average energy and heat capacity
</span>
<span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Temperature</span><span class="p">))</span>
<span class="n">En_avg</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Temperature</span><span class="p">))</span>
<span class="n">CV</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Temperature</span><span class="p">))</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

</code></pre></div></div> <p>Now we are ready to write for loop to sweep over the temperature range and calculate the energy, magnetization and specific heat capacity. We will use the following code:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Simulate at particular temperatures (T) and compute physical quantities
</span>
<span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">T</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">track</span><span class="p">(</span><span class="n">Temperature</span><span class="p">)):</span>

    <span class="c1"># Sweeps spins
</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">mc</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

    <span class="c1"># Compute physical quanitites with 1000 sweeps per spin at temperature T
</span>
    <span class="n">En_avg</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">mag</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">CV</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">physics</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Time it took in seconds is = %s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>

<span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span>

<span class="k">print</span><span class="p">(</span><span class="s">'It took '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">+</span> <span class="s">' minutes to execute the code'</span><span class="p">)</span>

</code></pre></div></div> <p>Now let’s plot the results. We will use the following code that plots the energy, magnetization and specific heat capacity as a function of temperature:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span> <span class="c1"># plot the calculated values
</span><span class="n">sp</span> <span class="o">=</span>  <span class="n">f</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Temperature</span><span class="p">,</span> <span class="n">En_avg</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">'.'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'IndianRed'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Temperature (T)"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Energy "</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>         <span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'tight'</span><span class="p">);</span>

<span class="n">sp</span> <span class="o">=</span>  <span class="n">f</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Temperature</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mag</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s">'.'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'RoyalBlue'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Temperature (T)"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span> 
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Magnetization "</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>   <span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'tight'</span><span class="p">);</span>

<span class="n">sp</span> <span class="o">=</span>  <span class="n">f</span><span class="p">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">);</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Temperature</span><span class="p">,</span> <span class="n">CV</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">'.'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'IndianRed'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"Temperature (T)"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>  
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"Specific Heat "</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span>   <span class="n">plt</span><span class="p">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'tight'</span><span class="p">);</span>   

<span class="n">plt</span><span class="p">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">,</span> <span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">"Simulation of 2D Ising Model by Metropolis Algorithm</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> <span class="s">"Lattice Dimension:"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="s">"X"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
    <span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> <span class="s">"External Magnetic Field(B)="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> <span class="s">"Metropolis Step="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span> <span class="c1"># function to show the plots
</span></code></pre></div></div> <h2 id="results">Results</h2> <p>These are plots of the physical quantities for different MC steps.</p> <p><img src="/assets/images/posts/ising/plot_1.png" alt="Simulation results for 50*50 lattice with 500000 steps" class="center-image" /></p> <h2 id="reproduction">Reproduction</h2> <p>You can run the Jupyter Notebook provided on Colab directly, or you can download from my project <a href="https://github.com/MohamedElashri/IsingModel">GitHub repository</a> and run locally. Also, there is python script that you can run. I’m using Numba cache so that it produces cache folder (specific to machine CPU and configuration) so that you will need to produce yours by running it for one time and subsequent runs will be about twice faster.</p> <p>To run the script</p> <ol> <li>clone the repository <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/MohamedElashri/IsingModel
</code></pre></div> </div> </li> <li>run the script <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python IsingModel/IsingModel.py
</code></pre></div> </div> </li> </ol> <h2 id="appendix-i">Appendix I</h2> <p>I spent many nights working on this work, most of time I needed to optimize my code, I even tried to move to Matlab (last time I used it was like 5 years ago). But I learned a nice thing from my desire to optimize code speed. It is the usage of Numba’s JIT compiler. Read more about that <a href="https://web.archive.org/web/20210802225233/http://melashri.net/url/b">here</a>. I also instead of using multiple nested loops I dragged all these into just one. Imagine running 50x50 lattice simulation in my older codes for hours (one took 6 hours) vs 15 minutes for the current script. (On my Mac m1 Machine). Also, I made the code available on colab and can be accessed <a href="https://web.archive.org/web/20210802225233/http://melashri.net/url/c">here</a> (without many comments).</p> <h2 id="appendix-ii">Appendix II</h2> <p>I have used this codebase as a benchmark test for python releases. I plan on maintain this test (available as <a href="https://github.com/MohamedElashri/python_bench_ising">repo</a> on github). Initialy I used numpy-1.23.4 for all different version of python used in the benchmark. This is the latest version of numpy. I got the following results.</p> <h3 id="results-1">Results</h3> <p>The benchmarks are executed on Macbook pro Apple Silicon M1 version. The python version are installed using <code class="highlighter-rouge">homebrew</code></p> <p>The arguments of the script are L(length of the lattice), n(number of Monte Carlo cycles).</p> <h4 id="python-311">python 3.11</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">time </span>python3.11 ising.py 10 10000
Time it took <span class="k">in </span>seconds is <span class="o">=</span> 109.2954261302948
python3.11 ising.py 10 10000  110.82s user 0.79s system 100% cpu 1:51.38 total
</code></pre></div></div> <h4 id="python-310">python 3.10</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">time </span>python3.10 ising.py 10 10000
Time it took <span class="k">in </span>seconds is <span class="o">=</span> 123.83638191223145
python3.10 ising.py 10 10000  124.80s user 0.69s system 101% cpu 2:04.06 total
</code></pre></div></div> <h4 id="python-39">python 3.9</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">time </span>python3.9 ising.py 10 10000
Time it took <span class="k">in </span>seconds is <span class="o">=</span> 123.56476402282715
python3.9 ising.py 10 10000  123.94s user 1.08s system 101% cpu 2:03.67 total
</code></pre></div></div> <h4 id="python-38">python 3.8</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">time </span>python3.8 ising.py 10 10000
Time it took <span class="k">in </span>seconds is <span class="o">=</span> 135.1741383075714
python3.8 ising.py 10 10000  137.05s user 1.00s system 100% cpu 2:17.24 total
</code></pre></div></div> <h4 id="other-versions">Other versions</h4> <p>Python started supporting apple silicon starting from <code class="highlighter-rouge">python3.8</code> and I try to make things as consistent as possible. Not to mention that <code class="highlighter-rouge">numpy</code> optimization for different version might be unaccounted difference.</p> </div> </article> <aside id="comments" class="isso"> <div class="container"> <h3><i class="icon icon-comments-o"></i> Comments</h3> <div id="isso_thread"></div> <script data-isso="https://comments.melashri.eu.org/" data-isso-avatar="true" data-isso-vote="true" data-isso-vote-levels="-5,5" src="https://comments.melashri.eu.org/js/embed.min.js"></script> <section id="isso-thread"></section> <noscript> Please enable JavaScript to view the <a href="https://blog.melashri.net" rel="nofollow">comments powered by ISSO.</a> </noscript> </div> </aside> <footer class="site-footer"> <div class="container"> <small class="block">&copy; 2023 Mohamed Elashri &middot; &lt;/&gt; Powered by <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://github.com/VerifiedGruber/thinkspace">Thinkspace theme</a></small> </div> </footer> </main> </body> </html>
