<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Self-hosted firefox sync server | My Blog </title> <meta name="description" content=" How to run firefox sync server on your own server "> <meta name="keywords" content="firefox, sync, server, self-hosted, firefox sync server"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="MohamedElashri"> <meta name="twitter:title" content=" Self-hosted firefox sync server | My Blog "> <meta name="twitter:description" content=" How to run firefox sync server on your own server "> <meta name="twitter:image:src" content="https://blog.melashri.net"> <!-- Canonical link tag --> <link rel="canonical" href="https://blog.melashri.net/2022/Run-firefox-sync-server/"> <link rel="alternate" type="application/rss+xml" title="My Blog" href="https://blog.melashri.net/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="https://blog.melashri.net/assets/css/main.css"> <link rel="stylesheet" href="/assets/css/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous"> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="https://blog.melashri.net/">My Blog<span></span></a> </h1> <ul class="navbar"> <li><a href="https://blog.melashri.net/about">About</a></li> <li><a href="https://blog.melashri.net/feed.xml" target="_blank">RSS</a></li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <p class="post-meta"><time datetime="2022-12-06T00:00:00+00:00" itemprop="datePublished">Dec 6, 2022</time></p> <h1 class="post-title" itemprop="name headline">Self-hosted firefox sync server</h1> </header> <div class="post-content" itemprop="articleBody"> <p>Firefox Sync is a powerful feature that allows you to keep your bookmarks, history, and other data in sync across all of your devices. It’s a great way to ensure that your favorite websites and browsing habits are always with you, no matter where you are.</p> <p>If you’re a privacy-conscious user like me, you may be hesitant to rely on Mozilla’s servers to store your data. Fortunately, it’s possible to run your own Firefox Sync server, giving you complete control over where your data is stored and how it is accessed.</p> <p>In this blog post, I will walk you through the steps for setting up your own Firefox Sync server. This installation method is going to be docker based, so you will need to have docker installed on your server. If you don’t have docker installed, you can follow the instructions here to install it. You can find instructions for doing this on the <a href="https://docs.docker.com/engine/install/ubuntu/">Install Docker-Engine</a>. Also you will need to install docker-compose, this is also available on the <a href="https://docs.docker.com/compose/install/">Install docker-compose</a>.</p> <p>Alternatively, you can use the following shell script to install docker and docker-compose on your server:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

apt-get update <span class="nt">-y</span>
apt-get <span class="nb">install</span> <span class="nt">-y</span> apt-transport-https ca-certificates curl software-properties-common

<span class="nb">sudo mkdir</span> <span class="nt">-p</span> /etc/apt/keyrings
 

curl <span class="nt">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg | <span class="nb">sudo </span>gpg <span class="nt">--dearmor</span> <span class="nt">-o</span> /etc/apt/keyrings/docker.gpg

<span class="nb">echo</span> <span class="se">\</span>
  <span class="s2">"deb [arch=</span><span class="si">$(</span>dpkg <span class="nt">--print-architecture</span><span class="si">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu </span><span class="se">\</span><span class="s2">
  
  </span><span class="si">$(</span>lsb_release <span class="nt">-cs</span><span class="si">)</span><span class="s2"> stable"</span> | <span class="nb">sudo tee</span> /etc/apt/sources.list.d/docker.list <span class="o">&gt;</span> /dev/null

apt-get update <span class="nt">-y</span>

apt-get <span class="nb">install </span>docker-ce docker-ce-cli containerd.io docker-compose-plugin <span class="nt">-y</span>
</code></pre></div></div> <p>Next, create a file called docker-compose.yml in a new directory on your server. This file will contain the configuration for your Firefox Sync server. In this file you will need to add the following configuration:</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3.2"</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">firefox-syncserver</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">crazymax/firefox-syncserver:latest</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">firefox</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">target</span><span class="pi">:</span> <span class="m">5000</span>
        <span class="na">published</span><span class="pi">:</span> <span class="m">5000</span>
        <span class="na">protocol</span><span class="pi">:</span> <span class="s">tcp</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">/home/&lt;user&gt;/firefox-sync/data:/data"</span>
    <span class="na">env_file</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">/home/&lt;user&gt;/firefox-sync/firefox.env"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">firefox-syncserver</span><span class="pi">:</span>
</code></pre></div></div> <p>This configuration will create a docker container that will run the Firefox Sync server. It will also create a volume that will store the data for the server. You will need to replace the <user> with your username on the server. You can also change the port that the server is running on, if you want to. One important thing is that you will need to pass a .env file to the container. This file will contain the configuration for the server. You can find an example of this file in the following code</user></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">TZ</span><span class="o">=</span>America/NewYork
<span class="nv">PUID</span><span class="o">=</span>1000
<span class="nv">PGID</span><span class="o">=</span>1000
<span class="nv">FF_SYNCSERVER_PUBLIC_URL</span><span class="o">=</span>http://&lt;server&gt;.&lt;domain&gt;
<span class="nv">FF_SYNCSERVER_SECRET</span><span class="o">=</span>736hdojh929jdmo
<span class="nv">FF_SYNCSERVER_ALLOW_NEW_USERS</span><span class="o">=</span><span class="nb">true

</span><span class="nv">FF_SYNCSERVER_FORCE_WSGI_ENVIRON</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div></div> <p>The explnation for each of these variables is as follows:</p> <ul> <li> <p><code class="highlighter-rouge">TZ</code>: This variable specifies the time zone for the application or service. In this case, the value is set to America/NewYork, indicating that the time zone is Eastern Standard Time.</p> </li> <li> <p><code class="highlighter-rouge">PUID</code> and <code class="highlighter-rouge">PGID</code>: These variables specify the user and group IDs for the application or service. In this case, the values are set to 1000, indicating that the application or service will run as the user and group with IDs 1000.</p> </li> <li> <p><code class="highlighter-rouge">FF_SYNCSERVER_PUBLIC_URL</code>: This variable specifies the public URL for the Firefox Sync server. In this case, the value is set to http://<server>.<domain>, indicating that the server is accessible at the specified domain name.</domain></server></p> </li> <li> <p><code class="highlighter-rouge">FF_SYNCSERVER_SECRET</code>: This variable specifies a secret value that is used to authenticate requests to the Firefox Sync server. In this case, the value is a long, random string of characters.</p> </li> <li> <p><code class="highlighter-rouge">FF_SYNCSERVER_ALLOW_NEW_USERS</code>: This variable specifies whether new users are allowed to register for the Firefox Sync server. In this case, the value is set to true, indicating that new users are allowed to register.</p> </li> <li> <p><code class="highlighter-rouge">FF_SYNCSERVER_FORCE_WSGI_ENVIRON</code>: This variable specifies whether the WSGI environment should be forced when running the Firefox Sync server. In this case, the value is set to false, indicating that the WSGI environment will not be forced.</p> </li> </ul> <p>Once you’ve created your docker-compose.yml file and added your <code class="highlighter-rouge">firefox.env</code> file, you can start your Firefox Sync container by running the following command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up <span class="nt">-d</span>
</code></pre></div></div> <p>This will pull the crazymax/firefox-syncserver image from the Docker Hub, create a new container using the configuration in your docker-compose.yml file, and start the container in the background. After your container is up and running, you can configure your Firefox browser to use your new Sync server. This can be done by going to the Sync settings in Firefox and entering the URL for your server. To do this you will need to modify <code class="highlighter-rouge">identity.sync.tokenserver.uri</code> in <code class="highlighter-rouge">about:config</code> . First you will need to go to <code class="highlighter-rouge">about:config</code> and then search for <code class="highlighter-rouge">identity.sync.tokenserver.uri</code> and change the value to the URL of your server. You can find the default value for this variable to be:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://token.services.mozilla.com/1.0/sync/1.5
</code></pre></div></div> <p>You will need to change this value to the URL of your server. Adjust the URL to match the domain name of your server. For example, if your server is running at <code class="highlighter-rouge">https://&lt;server&gt;.&lt;domain&gt;</code>, you will need to change the value to:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://&lt;server&gt;.&lt;domain&gt;/1.0/sync/1.5
</code></pre></div></div> <p>Once you’ve done that, you’ll be able to start syncing your data to your own server. You can then use the same account on all of your other devices to keep your data in sync across all of them.</p> </div> </article> <aside id="comments" class="isso"> <div class="container"> <h3><i class="icon icon-comments-o"></i> Comments</h3> <div id="isso_thread"></div> <script data-isso="https://comments.melashri.eu.org/" data-isso-avatar="true" data-isso-vote="true" data-isso-vote-levels="-5,5" src="https://comments.melashri.eu.org/js/embed.min.js"></script> <section id="isso-thread"></section> <noscript> Please enable JavaScript to view the <a href="https://blog.melashri.net" rel="nofollow">comments powered by ISSO.</a> </noscript> </div> </aside> <footer class="site-footer"> <div class="container"> <small class="block">&copy; 2023 Mohamed Elashri &middot; &lt;/&gt; Powered by <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://github.com/VerifiedGruber/thinkspace">Thinkspace theme</a></small> </div> </footer> </main> </body> </html>
